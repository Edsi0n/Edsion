# browser 小记

[前端面试查漏补缺--(十二) 从输入 URL 到看到页面发生的全过程(含三握手,四挥手详解)](https://juejin.im/post/5c6f9d24e51d4511dd3fd0a2)

[前端面试查漏补缺--(九) HTTP 与 HTTPS](https://juejin.im/post/5c6e5803f265da2dc0065437)

## 网络传输层

### 端口

::: cd
用来标识同一个主机上通信的不同应用程序

一个端口只能分配给一个应用程序，如果服务器有两个程序 A 和 B，分别启动了 A 服务 B 服务，它们监听同一个端口，那有数据来的时候，将无法判断这个数据分给 A 还是 B。

:::

### UDP 协议

::: cd

是一种无连接的传输层协议，提供面向事务的简单不可靠的传输服务。

主要有以下特点：

- UDP 是**无连接**的，减少开销和发送数据之前的时间延迟。大家都知道 TCP 的**三次握手和四次分手**，这个是需要时间花销的，但是 UDP 没有这部分花销。
- UDP 使用**最大努力交付**，即不保证可靠交付。那谁来保证可靠的交付呢？是由 UDP 的上一层协议，应用层来保证。
- UDP 是**面向报文的**，适合一次性传输少量数据的网络应用。什么意思呢，如下图，UDP 这层，把应用层的全部内容作为自己的数据报部分，在 IP 层也只是加了一个 IP 首部，我们知道，在以太网，链路层上的数据如果超过 1500 字节，就会分片，所以网络层发现上面传输层给了太大的数据就会分片，加上 UDP 是不可靠的协议，这就加大了 UDP 的**不可靠性**，容易丢失，所以 UDP 适合数据量少的。

![UDP](/img/question/network/udp.png)

- UDP 没有拥塞控制，适合很多实时应用。也就是说如果网络堵塞，UDP 不管那么多，照样按照自己的速率发数据，那有些人就会说，这协议是不是有点坑 B，路都堵上了，还发死劲发数据呢，但是反过来看，这也是 UDP 的优点，它允许丢包，如果你的网络情况还不错，UDP 就非常适合实时应用，比如视频会议。

- UDP 首部较小，只有 8 字节，而 TCP 由 20 字节。这也是减少网络传输开销的一方面。
  :::

### TCP 协议

> TCP 协议简单来说是一种位于传输层的，面向连接的、可靠的、基于字节流的传输层通信协议.

:::cd
TCP 协议的特点:

- TCP 是面向连接的传输层协议。比如说 TCP 的三次握手，四次分手，针对的都是连接。
- 每一条 TCP 连接只能有两个端点，每一条 TCP 连接是点对点的。也就是说 TCP 是不同计算机之间的进程的通信。
- TCP 提供可靠交付的服务，无差错，不丢失，不重复，按序到达。总结一下就是，可靠有序，不丢不重。
- TCP 提供全双工通信。全双工指的是连接双方可以同时收发数据。在收发两端都有发送缓存和接收缓存，发送缓存就是一个准备发送的队列，接收缓存是一个准备接收的队列。
- TCP 面向字节流。如下图，我们解释一下什么是面向字节流

![tcp](/img/question/network/tcp.png)

图中的 1，2，3，4.....数据块，每一个表示一个字节。tcp 将应用层的数据变为了这样的字节进行发送.

TCP 报文的首部格式
如下图所示，我们看一下比较重要的一些首部字段，这里我们介绍固定的 20 字节的 TCP 首部

![tcp首部](/img/question/network/tcphead.png)

- 源端口和目的端口分别是指发送方应用程序的端口和目的方应用程序的端口号。
- 序号是指在一个 TCP 连接中传送的字节流中的每一个字节都按顺序编号，本字段表示本报文段所发送数据的第一个字节的序号。

- 确认号是指期望收到对方下一个报文段的第一个数据字节的序号。弱确认好位 n，则证明到需要 N-1 为止所有的数据都已经正确收到。如下图，我们举例说明一下

![tcp](/img/question/network/tcpqr.png)

接收方收到了 1，2，3 个字节组成的数据包，然后接收方就会发送一个确认报文给发送方，其中确认报文的确认号就应该是 4，因为 1，2，3 这三个字节的组成的数据包已经收到了。

- 数据偏移指的是 TCP 报文段的数据起始处举例 TCP 报文段的起始处有多远。
- 6 个控制位介绍如下
  |控制位|作用|
  |:-|:-|
  |ACK|置 1 时表示确认号合法，为 0 的时候表示数据段不包含确认信息，确认号被忽略|
  |PSH|置 1 时请求的数据段在接收方得到后就可直接送到应用程序，而不必等到缓冲区满时才传送|
  |RST|置 1 时重建连接。如果接收到 RST 位时候，通常发生了某些错|
  |SYN|置 1 时用来发起一个连接|
  |FIN|置 1 时表示发端完成发送任务。用来释放连接，表明发送方已经没有数据发送了|
  |URG|紧急指针，告诉接收 TCP 模块紧要指针域指着紧要数据|
  :::

### TCP 建立连接（三次握手）

:::cd

如下图所示，tcp 建立连接的过程：

![tcp3](/img/question/network/tcp3.png)

- 首先客户端要发送一个数据包告诉服务器要建立连接，建立连接需要把 SYN 码设置为 1，seq 是序列号，随机数。
- 服务端接收到数据包后会，会为该 TCP 连接分配缓存和变量，缓存是指一个字节流队列。（发送方和接收方都有这个队列，而且如果双方需要相互通信，那么双方都会发送缓存和接收缓存），接着会返回一个确认报文，其中 SYN 控制位置为 1，意思是允许建立连接，ACK 是确认号，确认收到了发送方的包，并且会设一个 seq 序号，也为一个随机数。小写 ack 是确认号，也就是接下来希望发送方要发的数据从哪开始。
- 客户端需要给服务器端返回一个确认，此时 SYN 控制位变为 0，意思这不是建立连接的请求了，要正式发数据了，ACK 是确认码，意思是收到了服务器的确认请求了。  
  :::
