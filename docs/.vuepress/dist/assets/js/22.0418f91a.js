(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{221:function(t,e,s){"use strict";s.r(e);var a=s(0),v=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"vue-小记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-小记"}},[t._v("#")]),t._v(" vue 小记")]),t._v(" "),s("h2",{attrs:{id:"vue-双向绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-双向绑定"}},[t._v("#")]),t._v(" vue 双向绑定")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("vue 双向绑定 1")]),t._v(" "),s("details",{staticClass:"custom-block details",attrs:{open:""}},[s("summary",[t._v("点击查看答案")]),s("p",[t._v("双向绑定是通过"),s("strong",[t._v("数据劫持")]),s("code",[t._v("Object.defineproperty()")]),t._v("结合"),s("strong",[t._v("发布者-订阅者模式")]),t._v("的方式来实现的。")]),t._v(" "),s("p",[t._v("注：此处讨论的是 "),s("code",[t._v("vue2.x")]),t._v(" 版本，"),s("code",[t._v("vue3.x")]),t._v(" 版本以从 "),s("code",[t._v("Object.defineproperty()")]),t._v("升级为 "),s("code",[t._v("Proxy()")])]),t._v(" "),s("p",[t._v("我们先看一段伪代码")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      people"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ziwen"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("我们可以看一下通过控制台输出一个定义在 vue 初始化数据上的对象长啥样。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/question/vue/qv1.png",alt:"图片"}}),t._v("\n属性 "),s("code",[t._v("name")]),t._v(" 对应着 "),s("code",[t._v("get")]),t._v(" 和 "),s("code",[t._v("set")]),t._v(" 方法，哪来的呢？"),s("code",[t._v("Object.defineproperty()")]),t._v("赋予的。")]),t._v(" "),s("p",[s("code",[t._v("Object.defineproperty()")]),t._v("到底是何方神圣？详细用法请看"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("这里")]),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"思路分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思路分析"}},[t._v("#")]),t._v(" 思路分析")]),t._v(" "),s("p",[t._v("其实就是数据劫持。接下来我们通过其原理实现一个简易版的 "),s("code",[t._v("mvvm")]),t._v(" 双向绑定代码。\n主要包含两大重点："),s("strong",[t._v("数据("),s("code",[t._v("data")]),t._v(")驱动视图("),s("code",[t._v("view")]),t._v(")")]),t._v("，"),s("strong",[t._v("视图("),s("code",[t._v("view")]),t._v(")更新数据("),s("code",[t._v("data")]),t._v(")")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/question/vue/sxbdyl.jpg",alt:"双向绑定原理"}})]),t._v(" "),s("p",[s("code",[t._v("view")]),t._v(" 更新 "),s("code",[t._v("data")]),t._v(" 可以通过事件监听（比如监听 "),s("code",[t._v("input")]),t._v(" 事件）\n"),s("code",[t._v("data")]),t._v(" 更新 "),s("code",[t._v("view")]),t._v(" 呢？重点是如何知道数据变了。其实不难发现上边的例子中可以看到 "),s("code",[t._v("Object.defineProperty()")]),s("strong",[t._v("给属性设置一个 "),s("code",[t._v("set")]),t._v(" 函数")]),t._v("，当数据改变了就会触发这个函数，所以我们只要将一些更新 "),s("code",[t._v("view")]),t._v(" 的方法添加到 "),s("code",[t._v("set")]),t._v(" 函数里就可以更新 "),s("code",[t._v("view")]),t._v(" 了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/question/vue/qv2.jpg",alt:"图片"}})]),t._v(" "),s("h4",{attrs:{id:"实现双向绑定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现双向绑定"}},[t._v("#")]),t._v(" 实现双向绑定")]),t._v(" "),s("ul",[s("li",[t._v("设置一个 "),s("code",[t._v("Observer")]),t._v("，用来劫持并监听所有 "),s("code",[t._v("data")]),t._v(" 对象属性，如果有变化就通知订阅者。")]),t._v(" "),s("li",[t._v("设置一个 "),s("code",[t._v("Warcher")]),t._v("，可以收到属性的变化通知并执行响应的函数，来更新视图。")]),t._v(" "),s("li",[t._v("设置一个 "),s("code",[t._v("Dep")]),t._v("，用来收集订阅者，然后在 "),s("code",[t._v("Observer")]),t._v(" 和 "),s("code",[t._v("Watcher")]),t._v(" 之间进行统一管理。")]),t._v(" "),s("li",[t._v("设置一个 "),s("code",[t._v("Compile")]),t._v("，用来扫描和解析每个节点的相关指令，并根据初始化模板数据以及初始化相应的订阅器。")])]),t._v(" "),s("h4",{attrs:{id:"_1-设置一个-observer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-设置一个-observer"}},[t._v("#")]),t._v(" 1. 设置一个 Observer")]),t._v(" "),s("p",[t._v("用来劫持并监听所有 "),s("code",[t._v("data")]),t._v(" 对象属性。可以通过递归方法遍历所有属性，并用 "),s("code",[t._v("Object.defineProperty()")]),t._v("处理。\n另外需要一个 "),s("code",[t._v("Dep")]),t._v(" 订阅器负责收集订阅者，然后在属性变化时执行对应订阅者的更新函数。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code")])])])])])}),[],!1,null,null,null);e.default=v.exports}}]);